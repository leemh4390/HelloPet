<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.hellopet.dao.MyDAO">

  <!-- 
   날짜 : 2023/03/17
   내용 : my 페이지 기능 구현
   담당 : 이민혁
   -->

	<select id="selectUser" resultType="kr.co.hellopet.vo.MemberVO">
		select * from `pet_owner` where `uid` = #{uid};	
	</select>

	<select id="selectMyArticle" resultType="kr.co.hellopet.vo.CommunityVO">
		SELECT * FROM `community_article` WHERE `uid` = #{uid} ORDER BY `no` DESC LIMIT #{start},7;
	</select>
	
	<select id="selectMyQna" resultType="kr.co.hellopet.vo.CsVO">
		SELECT * FROM `cs_article` WHERE `uid` = #{uid} ORDER BY `no` DESC LIMIT #{start},7;
	</select>
	
	<select id="selectMyReserve" resultType="kr.co.hellopet.vo.ReserveVO">
		SELECT a.*, b.hosName FROM `reserve_list` AS a JOIN `api_hospital` AS b ON a.medNo = b.hosNo WHERE a.uid =  #{uid} LIMIT #{start}, 7;
	</select>
	
	<select id="selectMyReserves" resultType="kr.co.hellopet.vo.ReserveVO">
		SELECT a.*, b.hosName FROM `reserve_list` AS a JOIN `api_hospital` AS b ON a.medNo = b.hosNo WHERE a.uid =  #{uid} LIMIT 7;
	</select>
	
	<select id="selectCountMyArticle" resultType="int">
		SELECT COUNT(`no`) FROM `cs_article` WHERE `uid` = #{uid};
	</select>
	
	<select id="selectCountMyQna" resultType="int">
		SELECT COUNT(`no`) FROM `cs_article` WHERE `uid` = #{uid};
	</select>
	
	<select id="selectCountMyReserve" resultType="int">
		SELECT COUNT('revNo') FROM `reserve_list` WHERE `uid` = 'leemh4390'
	</select>	

	<!-- 회원정보 update -->
	<update id="updateInfoModify">
	    UPDATE pet_owner
	    SET `name` = #{name}, `email`= #{email}, `nick` = #{nick}, `hp` = #{hp}
	    WHERE `uid` = #{uid};
	</update>
	
	<!-- 회원 삭제는 하지않고 level 만 변경 -->
	<update id="deleteWithdrawMember">
		UPDATE `pet_owner` SET `level` = 0, `wdate` = NOW()  WHERE `uid` = #{uid};
	</update>
	
	<!-- 예약 삭제 -->
	<delete id="deleteMyReserve">
		DELETE FROM `reserve_list` WHERE `revNo` = #{no};
	</delete>
</mapper>